{% extends "base.html" %}

{% load staticfiles i18n %}

{% block sidebar %}{% include "sidebar.html" with section='invoices' %}{% endblock %}

{% block main %}
<script type="text/javascript">
    view = new views.Invoice({{object_json|safe}});
</script>
<script id="template" type="x-tmpl-mustache">
    {% verbatim %}
    <div class="company-address">
        <span class="company-name">{{company_name}}</span><br>
        {{&company_address_html}}
    </div>
    <div class="company-info">
        {{&company_info_html}}
    </div>
    <div class="invoice-info">
        <strong class="invoice-label">{% endverbatim %}{% trans "Invoice" %}{% verbatim %}</strong><br>
        Invoice number: {{number}}<br>
        Date: {{date_formatted}}<br>
    </div>
    <div class="client-info">
        <strong>{{client.name}}</strong>
        {{&client_html}}
    </div>
    <div class="company-payment">
        Please make payment payable to: <span class="company-name">{{company_name}}</span><br>
        Bank account: {{company_account}}
    </div>
    <table class="description">
        <thead>
            <tr>
                {% endverbatim %}
                <th>{% trans "Week ending" %}</th>
                <th>{% trans "Days worked" %}</th>
                <th>{% trans "Daily rate" %}</th>
                <th>{% trans "Total" %}</th>
                {% verbatim %}
            </tr>
        </thead>
        <tbody>
            {{#days_worked_by_week}}
            <tr>
                <td>{{week_ending_formatted}}</td>
                <td>{{days_worked}}</td>
                <td>{{&daily_rate_html}}</td>
                <td>{{&total_html}}</td>
            </tr>
            {{/days_worked_by_week}}
        </tbody>
    </table>
    <table class="total">
        <tr>
            <th>{% endverbatim %}{% trans "Subtotal" %}{% verbatim %}</th>
            <td>{{&subtotal_html}}</td>
        </tr>
        <tr>
            <th>{% endverbatim %}{% trans "Total VAT" %}{% verbatim %} ({{tax_str}})</th>
            <td>{{&tax_total_html}}</td>
        </tr>
        <tr>
            <th>{% endverbatim %}{% trans "Total due" %}{% verbatim %}</th>
            <td>{{&total_html}}</td>
        </tr>
    </table>
    {% endverbatim %}
</script>
<script id="error400-template" type="x-tmpl-mustache">
    {% verbatim %}
    {{#errors}}
    <p><label><strong>{{field}}</strong></label>{{#errors}}<br>{{.}}{{/errors}}</p>
    {{/errors}}
    {% endverbatim %}
</script>
<article id="sheet"></article>
{% endblock %}

{% block menu %}
<aside role="menu">
    <h1>{% trans "Invoice" %}</h1>
    <ul>
        <li><span onclick="view.save();">{% trans "Save" %}</span></li>
        <li><span{% if not object.saved %} class="inactive"{% endif %}>{% trans "Email" %}</span></li>
        <li><span{% if not object.saved %} class="inactive"{% endif %}>{% trans "Download" %}</span></li>
        <li><span onclick="view.popups.settings.open();">{% trans "Settings" %}</span></li>
        <li><span onclick="view.popups.delete.open();">{% trans "Delete" %}</span></li>
    </ul>
</aside>
{% endblock %}

{% block popups %}
<div id="settings">
    <header>
        {% trans "Settings" %}
        <button type="button" data-close>x</button>
    </header>
    <div class="content">
        {% if object.created_from_days %}
        <form>
            <div>
                <label>{% trans "Invoice number" %}</label>
                <input type="text" name="number" value="{{object.number}}">
            </div>
            <div>
                <label>{% trans "Date" %}</label>
                <input type="text" name="date" value="{{object.date|date:'Y-m-d'}}">
            </div>
            <div>
                <label>{% trans "Client" %}</label>
                <select name="client">
                    {% for client in clients %}
                    <option value="{{client.pk}}">{{client.name}}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label>{% trans "Daily rate" %}</label>
                <input type="number" name="daily_rate" value="{{object.daily_rate}}">
            </div>
            <div>
                <label>{% trans "VAT" %}</label>
                <input type="number" name="tax" value="{{object.tax}}" step="0.01">
            </div>
        </form>
        {% else %}
        <form>
            <div>
                <label>{% trans "Invoice number" %}</label>
                <input type="text" name="number" value="{{object.number}}">
            </div>
            <div>
                <label>{% trans "Date" %}</label>
                <input type="text" name="date" value="{{object.date|date:'Y-m-d'}}">
            </div>
            <div>
                <label>{% trans "Client" %}</label>
                <select name="client">
                    {% for client in clients %}
                    <option value="{{client.pk}}">{{client.name}}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label>{% trans "Subtotal" %}</label>
                <input type="number" name="subtotal" value="{{object.subtotal}}">
            </div>
            <div>
                <label>{% trans "VAT" %}</label>
                <input type="number" name="tax" value="{{object.tax}}" step="0.01">
            </div>
            <div>
                <label>{% trans "PDF" %}</label>
                <input type="file" name="pdf">
            </div>
        </form>
        {% endif %}
    </div>
    <footer>
        <button type="button" data-accept>{% trans "OK" %}</button>
    </footer>
</div>
<div id="delete-confirmation">
    <div class="content">
        {% trans "Are you sure you want to delete this invoice?" %}
    </div>
    <footer>
        <button type="button" data-close>{% trans "No" %}</button>
        <button type="button" data-accept>{% trans "Yes" %}</button>
    </footer>
</div>
<div id="error400-message">
    <header>
        {% trans "Error" %}
        <button type="button" data-close>x</button>
    </header>
    <div class="content"></div>
    <footer>
        <button type="button" data-accept>{% trans "OK" %}</button>
    </footer>
</div>
<div id="error500-message">
    <header>
        {% trans "Error" %}
        <button type="button" data-close>x</button>
    </header>
    <div class="content">
        <p>{% trans "Internal server error" %}</p>
    </div>
    <footer>
        <button type="button" data-accept>{% trans "OK" %}</button>
    </footer>
</div>
{% endblock %}