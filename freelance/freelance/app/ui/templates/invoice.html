{% extends "base.html" %}

{% load staticfiles i18n %}

{% block sidebar %}{% include "sidebar.html" with section='invoices' %}{% endblock %}

{% block main %}
<script type="text/javascript">
    view = new views.Invoice({{object_json|safe}});
</script>
<script id="template" type="x-tmpl-mustache">
    {% verbatim %}
    <div class="company-address">
        <span class="company-name">{{company_name}}</span><br>
        {{&company_address}}
    </div>
    <div class="company-info">
        {{&company_info}}
    </div>
    <div class="invoice-info">
        <strong class="invoice-label">{% endverbatim %}{% trans "Invoice" %}{% verbatim %}</strong><br>
        Invoice number: {{number}}<br>
        Date: {{date__str}}<br>
    </div>
    <div class="client-info">
        <strong>{{client.name}}</strong>
        {{&client_html}}
    </div>
    <div class="company-payment">
        Please make payment payable to: <span class="company-name">{{company_name}}</span><br>
        Bank account: {{company_account}}
    </div>
    <table class="description">
        <thead>
            <tr>
                {% endverbatim %}
                <th>{% trans "Week ending" %}</th>
                <th>{% trans "Days worked" %}</th>
                <th>{% trans "Daily rate" %}</th>
                <th>{% trans "Total" %}</th>
                {% verbatim %}
            </tr>
        </thead>
        <tbody>
            {{#days_worked_by_week}}
            <tr>
                <td>{{week_ending__str}}</td>
                <td>{{days_worked}}</td>
                <td>{{daily_rate__str}}</td>
                <td>{{total__str}}</td>
            </tr>
            {{/days_worked_by_week}}
        </tbody>
    </table>
    <table class="total">
        <tr>
            <th>{% endverbatim %}{% trans "Subtotal" %}{% verbatim %}</th>
            <td>{{subtotal__str}}</td>
        </tr>
        <tr>
            <th>{% endverbatim %}{% trans "Total VAT" %}{% verbatim %} ({{tax_str}})</th>
            <td>{{tax_total__str}}</td>
        </tr>
        <tr>
            <th>{% endverbatim %}{% trans "Total due" %}{% verbatim %}</th>
            <td>{{total__str}}</td>
        </tr>
    </table>
    {% endverbatim %}
</script>
<script id="error400-template" type="x-tmpl-mustache">
    {% verbatim %}
    {{#errors}}
    <p><label><strong>{{field}}</strong></label>{{#errors}}<br>{{.}}{{/errors}}</p>
    {{/errors}}
    {% endverbatim %}
</script>
<input type="file" name="pdf" style="display:none;">
<article id="sheet"></article>
{% endblock %}

{% block menu %}
<aside role="menu">
    <h1>{% trans "Invoice" %}</h1>
    <ul>
        <li><span {% if object.saved %} class="inactive"{% else %} onclick="view.popups.save.open();"{% endif %}>{% trans "Save" %}</span></li>
        <li><span{% if not object.saved %} class="inactive"{% endif %}>{% trans "Email" %}</span></li>
        <li><a{% if not object.saved %} class="inactive"{% else %} href="{{object.pdf.url}}" download{% endif %}>{% trans "Download" %}</a></li>
        <li><span{% if object.sent %} onclick="view.update('paid');"{% else %} class="inactive"{% endif %}>{% trans "Set as paid" %}</span></li>
        <li><span{% if object.saved %} class="inactive"{% else %} onclick="view.popups.settings.open();"{% endif %}>{% trans "Settings" %}</span></li>
        <li><span onclick="view.popups.info.open();">{% trans "Info" %}</span></li>
        <!--<li><span>{% trans "Documents" %}</span></li>-->
        <li><span onclick="view.popups.delete.open();">{% trans "Delete" %}</span></li>
    </ul>
</aside>
{% endblock %}

{% block popups %}
<div id="settings">
    <header>
        {% trans "Settings" %}
        <button type="button" data-close>x</button>
    </header>
    <div class="content">
        {% if object.created_from_days %}
        <form>
            <div>
                <label>{% trans "Invoice number" %}</label>
                <input type="text" name="number" value="{{object.number}}">
            </div>
            <div>
                <label>{% trans "Date" %}</label>
                <input type="text" name="date" value="{{object.date|date:'Y-m-d'}}">
            </div>
            <div>
                <label>{% trans "Client" %}</label>
                <select name="client">
                    {% for client in clients %}
                    <option value="{{client.pk}}">{{client.name}}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label>{% trans "Daily rate" %}</label>
                <input type="number" name="daily_rate" value="{{object.daily_rate}}">
            </div>
            <div>
                <label>{% trans "VAT" %}</label>
                <input type="number" name="tax" value="{{object.tax}}" step="0.01">
            </div>
        </form>
        {% else %}
        <form>
            <div>
                <label>{% trans "Invoice number" %}</label>
                <input type="text" name="number" value="{{object.number}}">
            </div>
            <div>
                <label>{% trans "Date" %}</label>
                <input type="text" name="date" value="{{object.date|date:'Y-m-d'}}">
            </div>
            <div>
                <label>{% trans "Client" %}</label>
                <select name="client">
                    {% for client in clients %}
                    <option value="{{client.pk}}">{{client.name}}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label>{% trans "Subtotal" %}</label>
                <input type="number" name="subtotal" value="{{object.subtotal}}">
            </div>
            <div>
                <label>{% trans "VAT" %}</label>
                <input type="number" name="tax" value="{{object.tax}}" step="0.01">
            </div>
        </form>
        {% endif %}
    </div>
    <footer>
        <button type="button" data-accept>{% trans "OK" %}</button>
    </footer>
</div>
<div id="info">
    <header>
        {% trans "Info" %}
        <button type="button" data-close>x</button>
    </header>
    <div class="content">
        <table class="transposed">
            <tr>
                <th>{% trans "Invoice number" %}</th>
                <td>{{object.number}}</td>
            </tr>
            <tr>
                <th>{% trans "Invoice date" %}</th>
                <td>{{object.date|date:"d/m/Y"}}</td>
            </tr>
            <tr>
                <th>{% trans "Created" %}</th>
                <td>{{object.created|date:"d/m/Y H:i"}}</td>
            </tr>
            <tr>
                <th>{% trans "Updated" %}</th>
                <td>{{object.updated|date:"d/m/Y H:i"}}</td>
            </tr>
            {% if object.date_paid %}
            <tr>
                <th>{% trans "Paid" %}</th>
                <td>{{object.date_paid}} </td>
            </tr>
            {% endif %}
            <tr>
                <th>{% trans "Client" %}</th>
                <td>{{object.client}}</td>
            </tr>
            <tr>
                <th>{% trans "Subtotal" %}</th>
                <td>{{object.subtotal}}</td>
            </tr>
            <tr>
                <th>{% trans "Tax" %}</th>
                <td>{{object.tax}}</td>
            </tr>
            <tr>
                <th>{% trans "Total" %}</th>
                <td>{{object.total}}</td>
            </tr>
            <tr>
                <th>{% trans "Daily rate" %}</th>
                <td>{{object.daily_rate}}</td>
            </tr>
            <tr>
                <th>{% trans "Status" %}</th>
                <td>{% if object.status == 0 %}{% trans "Draft" %}{% elif object.status == 1 %}{% trans "Saved" %}{% elif object.status == 2 %}{% trans "Sent" %}{% else %}{% trans "Paid" %}{% endif %}</td>
            </tr>
            <tr>
                <th>{% trans "Created from" %}</th>
                <td>{% if object.created_from == 0 %}{% trans "Calendar" %}{% else %}{% trans "File" %}{% endif %}</td>
            </tr>
            {% if object.created_from_days %}
            <tr>
                <th>{% trans "Days worked" %}</th>
                <td>{% for k, v in object.days_worked_dict.items %}{{k}}{% if v == .5 %}({% trans "halfday" %}){% endif %}{% if not forloop.last %}, {% endif %}{% endfor %}</td>
            </tr>
            {% endif %}
        </table>
    </div>
</div>
<div id="delete-confirmation">
    <div class="content">
        {% trans "Are you sure you want to delete this invoice?" %}
    </div>
    <footer>
        <button type="button" data-close>{% trans "No" %}</button>
        <a href="{% url 'invoice' object.number %}?delete=1">{% trans "Yes" %}</a>
    </footer>
</div>
<div id="save-confirmation">
    <div class="content">
        {% trans "Once you have saved the invoice this won't be editable." %}
    </div>
    <footer>
        <button type="button" data-close>{% trans "Cancel" %}</button>
        <button type="button" data-accept>{% trans "OK" %}</button>
    </footer>
</div>
<div id="error400-message">
    <header>
        {% trans "Error" %}
        <button type="button" data-close>x</button>
    </header>
    <div class="content"></div>
    <footer>
        <button type="button" data-accept>{% trans "OK" %}</button>
    </footer>
</div>
<div id="error500-message">
    <header>
        {% trans "Error" %}
        <button type="button" data-close>x</button>
    </header>
    <div class="content">
        <p>{% trans "Internal server error" %}</p>
    </div>
    <footer>
        <button type="button" data-accept>{% trans "OK" %}</button>
    </footer>
</div>
{% endblock %}